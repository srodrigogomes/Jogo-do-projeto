<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treinamento de Defesa - Naruto no Multiverso</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Inter:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            background-image: radial-gradient(#1e293b 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .code-font {
            font-family: 'Fira Code', monospace;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .option-btn {
            transition: all 0.2s ease;
        }
        .option-btn:hover {
            transform: translateX(5px);
            background-color: rgba(255, 159, 67, 0.1);
            border-color: #ff9f43;
        }
        
        .correct {
            background-color: rgba(46, 204, 113, 0.2) !important;
            border-color: #2ecc71 !important;
            color: #2ecc71;
        }

        .wrong {
            background-color: rgba(231, 76, 60, 0.2) !important;
            border-color: #e74c3c !important;
            color: #e74c3c;
        }

        .btn-disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.4s ease forwards;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="max-w-3xl w-full">
        <!-- Header -->
        <header class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-orange-400 to-red-500 flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-orange-500/20">
                    NM
                </div>
                <div>
                    <h1 class="text-xl font-bold text-white">Treinamento de Defesa</h1>
                    <p class="text-sm text-slate-400">Naruto no Multiverso - Code Quiz</p>
                </div>
            </div>
            <div class="text-right">
                <div class="text-xs text-slate-400 uppercase tracking-wider">Pontua√ß√£o</div>
                <div class="text-2xl font-bold text-orange-400" id="scoreDisplay">00</div>
            </div>
        </header>

        <!-- Game Area -->
        <main id="gameContainer" class="glass-panel rounded-2xl p-8 relative overflow-hidden">
            <!-- Progress Bar -->
            <div class="absolute top-0 left-0 h-1 bg-orange-500 transition-all duration-300" id="progressBar" style="width: 0%"></div>

            <!-- Start Screen -->
            <div id="startScreen" class="text-center py-10">
                <div class="mb-6 inline-block p-4 rounded-full bg-slate-800 border border-slate-700">
                    <i class="fas fa-code text-4xl text-orange-400"></i>
                </div>
                <h2 class="text-3xl font-bold mb-4 text-white">Preparado para a Banca?</h2>
                <p class="text-slate-400 mb-8 max-w-md mx-auto">
                    Teste seus conhecimentos sobre o c√≥digo do seu jogo. 
                    Perguntas reais sobre <code>malloc</code>, <code>structs</code>, <code>Raylib</code> e l√≥gica do jogo.
                </p>
                <button onclick="startGame()" class="px-8 py-3 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition-colors shadow-lg shadow-orange-500/20">
                    Come√ßar o Desafio
                </button>
            </div>

            <!-- Question Screen -->
            <div id="questionScreen" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-xs font-bold text-slate-500 uppercase tracking-widest bg-slate-800 px-3 py-1 rounded-full" id="questionCategory">MEM√ìRIA</span>
                    <span class="text-sm text-slate-400">Quest√£o <span id="currentQ">1</span>/<span id="totalQ">15</span></span>
                </div>

                <h3 class="text-xl font-semibold mb-6 leading-relaxed" id="questionText">
                    Carregando pergunta...
                </h3>

                <div class="space-y-3" id="optionsContainer">
                    <!-- Op√ß√µes injetadas via JS -->
                </div>

                <!-- Feedback Area -->
                <div id="feedbackArea" class="hidden mt-6 p-4 rounded-lg bg-slate-800/50 border border-slate-700 slide-in">
                    <div class="flex items-start gap-3">
                        <i id="feedbackIcon" class="fas fa-check-circle text-green-500 mt-1"></i>
                        <div>
                            <h4 class="font-bold text-white mb-1" id="feedbackTitle">Correto!</h4>
                            <p class="text-sm text-slate-300 leading-relaxed" id="feedbackText"></p>
                        </div>
                    </div>
                    <button onclick="nextQuestion()" class="mt-4 w-full py-2 bg-slate-700 hover:bg-slate-600 text-white font-semibold rounded transition-colors">
                        Pr√≥xima Pergunta <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Result Screen -->
            <div id="resultScreen" class="hidden text-center py-8">
                <div id="rankIcon" class="text-6xl mb-4">üéì</div>
                <h2 class="text-3xl font-bold text-white mb-2">Treino Finalizado!</h2>
                <p class="text-slate-400 mb-6">Seu n√≠vel de conhecimento:</p>
                
                <div class="text-5xl font-bold text-orange-400 mb-2" id="finalScore">0</div>
                <div class="text-xl font-bold text-white mb-8 bg-slate-800 inline-block px-6 py-2 rounded-lg border border-slate-700" id="finalRank">GENIN</div>

                <div class="grid grid-cols-2 gap-4 mb-8 text-left max-w-md mx-auto">
                    <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                        <div class="text-xs text-slate-500 uppercase">Acertos</div>
                        <div class="text-2xl font-bold text-green-400" id="correctCount">0</div>
                    </div>
                    <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                        <div class="text-xs text-slate-500 uppercase">Erros</div>
                        <div class="text-2xl font-bold text-red-400" id="wrongCount">0</div>
                    </div>
                </div>

                <button onclick="location.reload()" class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-lg transition-colors">
                    <i class="fas fa-redo mr-2"></i> Tentar Novamente
                </button>
            </div>
        </main>

        <!-- Footer -->
        <footer class="mt-8 text-center text-xs text-slate-500">
            <p>Simulador desenvolvido para a defesa do projeto Naruto no Multiverso.</p>
        </footer>
    </div>

    <script>
        // BANCO DE PERGUNTAS BASEADO NO C√ìDIGO DO USU√ÅRIO
        const questions = [
            {
                category: "MEM√ìRIA",
                text: "No arquivo <code>palavras.c</code>, usamos a fun√ß√£o <code>realloc</code> dentro de <code>adicionarPalavraDireta</code>. Qual √© a fun√ß√£o exata do realloc neste contexto?",
                options: [
                    "Limpar a mem√≥ria da lista de palavras.",
                    "Redimensionar o array dinamicamente para caber mais uma palavra.",
                    "Alocar mem√≥ria para uma √∫nica string.",
                    "Mover a lista de palavras para o disco r√≠gido."
                ],
                correct: 1,
                explanation: "O <code>realloc</code> tenta expandir o bloco de mem√≥ria existente. Se n√£o houver espa√ßo adjacente, ele aloca um novo bloco maior, copia os dados antigos e libera o antigo. Isso permite que a lista cres√ßa indefinidamente."
            },
            {
                category: "ARQUITETURA",
                text: "O loop principal no <code>main.c</code> utiliza uma estrutura <code>switch(telaAtual)</code>. O que isso implementa?",
                options: [
                    "Uma lista encadeada.",
                    "Um algoritmo de ordena√ß√£o.",
                    "Uma M√°quina de Estados Finita (FSM).",
                    "Uma chamada recursiva."
                ],
                correct: 2,
                explanation: "Isso √© uma M√°quina de Estados. O jogo possui estados (MENU, JOGO, CINEMATICA) e o loop desenha e processa apenas o que √© relevante para o estado atual."
            },
            {
                category: "CINEM√ÅTICA",
                text: "Na cinem√°tica, usamos <code>strtok(buffer, '|')</code>. Por que usamos o caractere '|' (pipe) nos textos dos di√°logos?",
                options: [
                    "Para indicar onde o c√≥digo deve quebrar a linha visualmente na caixa de di√°logo.",
                    "Para separar o nome do personagem da fala.",
                    "√â um erro de digita√ß√£o, deveria ser uma v√≠rgula.",
                    "Para indicar o fim da string."
                ],
                correct: 0,
                explanation: "O Raylib n√£o quebra linhas automaticamente em <code>DrawText</code>. O caractere '|' foi escolhido como um marcador especial para o c√≥digo saber onde pular para a linha de baixo (Y + 26)."
            },
            {
                category: "L√ìGICA JOGO",
                text: "Em <code>jogo.c</code>, a fun√ß√£o <code>verificarLetra</code> retorna AMARELO (letraPosicaoErrada) quando:",
                options: [
                    "A letra n√£o existe na palavra.",
                    "A letra existe na palavra e est√° na posi√ß√£o correta.",
                    "A letra existe na palavra, mas est√° em uma posi√ß√£o diferente da digitada.",
                    "O usu√°rio digitou um n√∫mero."
                ],
                correct: 2,
                explanation: "Amarelo significa: a letra faz parte da senha secreta, mas o usu√°rio a colocou na casa errada. Verde seria posi√ß√£o certa, e Cinza/Preto seria inexistente."
            },
            {
                category: "ARQUIVOS",
                text: "Para salvar o progresso (<code>salvarProgresso</code>), usamos <code>fwrite</code> gerando um arquivo <code>.dat</code>. Por que n√£o usamos texto (<code>fprintf</code>)?",
                options: [
                    "Porque o C n√£o suporta arquivos de texto.",
                    "Porque arquivos bin√°rios s√£o mais dif√≠ceis de editar manualmente (seguran√ßa) e mais r√°pidos.",
                    "Porque arquivos bin√°rios ocupam mais espa√ßo.",
                    "Porque o Raylib exige arquivos bin√°rios."
                ],
                correct: 1,
                explanation: "O arquivo bin√°rio grava os bytes da mem√≥ria diretamente. Isso evita que o jogador abra o bloco de notas e mude o n√≠vel da fase facilmente, al√©m de ser computacionalmente mais eficiente."
            },
            {
                category: "MEM√ìRIA",
                text: "Em <code>inicializarJogo</code>, usamos <code>memset(estado, 0, sizeof(EstadoJogo))</code>. O que isso faz?",
                options: [
                    "Aloca mem√≥ria nova para o jogo.",
                    "Libera a mem√≥ria do jogo.",
                    "Preenche toda a struct com zeros, limpando 'lixo de mem√≥ria'.",
                    "Carrega as texturas do jogo."
                ],
                correct: 2,
                explanation: "O <code>memset</code> √© a 'borracha'. Vari√°veis em C n√£o s√£o limpas automaticamente ao serem criadas e podem conter valores aleat√≥rios antigos da RAM. O memset zera tudo."
            },
            {
                category: "PARSING",
                text: "Ao ler o CSV em <code>palavras.c</code>, usamos: <code>linha[strcspn(linha, '\\r\\n')] = 0;</code>. Para que serve isso?",
                options: [
                    "Para remover o caractere de nova linha (Enter) que o fgets l√™.",
                    "Para converter a linha para mai√∫sculo.",
                    "Para dividir a linha em tokens.",
                    "Para fechar o arquivo."
                ],
                correct: 0,
                explanation: "A fun√ß√£o <code>fgets</code> l√™ a linha inteira, inclusive o 'Enter' final. Isso atrapalha compara√ß√µes de string. O <code>strcspn</code> acha o Enter e o substitui por 0 (null terminator), limpando a string."
            },
            {
                category: "RAYLIB",
                text: "No ciclo de desenho, se chamarmos <code>DrawText</code> fora do bloco <code>BeginDrawing() / EndDrawing()</code>, o que acontece?",
                options: [
                    "O texto aparece normalmente.",
                    "O jogo fecha imediatamente.",
                    "Nada acontece ou a tela pisca, pois o buffer gr√°fico n√£o estava aberto.",
                    "O computador reinicia."
                ],
                correct: 2,
                explanation: "A Raylib precisa preparar o contexto gr√°fico (GPU) com <code>BeginDrawing</code>. Qualquer desenho fora desse bloco √© ignorado ou causa comportamento indefinido visual."
            },
            {
                category: "L√ìGICA JOGO",
                text: "A fun√ß√£o <code>adicionarLetra</code> usa <code>toupper(letra)</code>. Qual o motivo?",
                options: [
                    "Para deixar o jogo mais bonito.",
                    "Porque a tabela ASCII diferencia 'a' de 'A', e precisamos padronizar para comparar.",
                    "Porque o teclado s√≥ funciona com mai√∫sculas.",
                    "Para economizar mem√≥ria."
                ],
                correct: 1,
                explanation: "Em C, 'a' (97) √© diferente de 'A' (65). Se a senha for 'GOKU' e compararmos com 'goku', dar√° errado. Padronizamos tudo para mai√∫sculo para garantir a l√≥gica."
            },
            {
                category: "DEFESA",
                text: "Pergunta dif√≠cil: O que acontece se o arquivo <code>assets/palavras.csv</code> for deletado?",
                options: [
                    "O jogo trava (Crash).",
                    "O jogo n√£o abre.",
                    "O sistema de fallback (carregarPalavrasIniciais) carrega palavras padr√£o hardcoded no c√≥digo.",
                    "Aparece uma tela azul."
                ],
                correct: 2,
                explanation: "Isso √© um ponto forte do seu c√≥digo! Voc√™ implementou robustez. Se o <code>fopen</code> falhar, ele chama <code>adicionarPalavraDireta</code> manualmente com palavras como 'Goku' e 'Naruto' que est√£o escritas no .c."
            },
            {
                category: "ESTRUTURA",
                text: "Qual a diferen√ßa entre <code>palavras.h</code> e <code>palavras.c</code>?",
                options: [
                    "N√£o h√° diferen√ßa.",
                    "O .h tem o c√≥digo l√≥gico e o .c tem as defini√ß√µes.",
                    "O .h define o 'molde' (structs/prot√≥tipos) e o .c implementa a l√≥gica real.",
                    "O .h √© para Windows e o .c para Linux."
                ],
                correct: 2,
                explanation: "Header files (.h) s√£o contratos/interfaces. Source files (.c) s√£o a implementa√ß√£o. O .h diz 'existe uma struct Palavra', o .c diz 'como carregar essa palavra'."
            },
            {
                category: "PERFORMANCE",
                text: "Por que usamos <code>UnloadTexture</code> em <code>descarregarRecursosCinematica</code>?",
                options: [
                    "Para apagar a imagem do HD.",
                    "Para liberar a mem√≥ria VRAM da placa de v√≠deo e evitar vazamentos (Memory Leaks).",
                    "Porque a Raylib exige.",
                    "Para deixar o jogo mais lento."
                ],
                correct: 1,
                explanation: "Texturas ocupam muita mem√≥ria de v√≠deo. Se voc√™ carregar fase ap√≥s fase sem descarregar as anteriores, a mem√≥ria da GPU vai encher e o jogo vai travar."
            },
            {
                category: "SINTAXE",
                text: "Na struct, temos <code>char palavra[30]</code>. O que acontece se tentarmos gravar uma palavra com 50 letras?",
                options: [
                    "O array aumenta automaticamente.",
                    "Ocorre um Buffer Overflow, corrompendo mem√≥ria vizinha.",
                    "A palavra √© cortada automaticamente.",
                    "O compilador avisa e corrige."
                ],
                correct: 1,
                explanation: "Em C, arrays est√°ticos n√£o t√™m prote√ß√£o autom√°tica. Escrever al√©m do limite [30] invade mem√≥ria de outras vari√°veis, causando bugs bizarros ou crashes (Buffer Overflow)."
            },
            {
                category: "MAKEFILE",
                text: "No seu Makefile, existe uma verifica√ß√£o <code>ifeq ($(OS),Windows_NT)</code>. Para que serve?",
                options: [
                    "Para impedir que o jogo rode no Linux.",
                    "Para detectar o Sistema Operacional e ajustar comandos (como mkdir vs mkdir -p) e bibliotecas.",
                    "Para mudar a cor do terminal.",
                    "Para baixar o Windows."
                ],
                correct: 1,
                explanation: "Isso torna o projeto 'Cross-Platform'. Ele ajusta as flags de linkagem (libwin vs lib) e comandos de terminal dependendo de onde est√° sendo compilado."
            },
            {
                category: "PONTEIROS",
                text: "Em <code>adicionarPalavraDireta</code>, passamos <code>Palavra **lista</code> (ponteiro duplo). Por qu√™?",
                options: [
                    "Porque √© mais chique.",
                    "Para ter duas listas.",
                    "Porque o <code>realloc</code> pode mudar o endere√ßo de mem√≥ria da lista, e precisamos atualizar o ponteiro original na main.",
                    "Porque arrays em C sempre precisam de ponteiros duplos."
                ],
                correct: 2,
                explanation: "Se pass√°ssemos apenas <code>*lista</code>, o realloc mudaria o endere√ßo numa c√≥pia local. A main continuaria apontando para o endere√ßo antigo (inv√°lido). O ponteiro duplo permite alterar o endere√ßo que a main enxerga."
            }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let correctAnswers = 0;
        let wrongAnswers = 0;

        // Elementos DOM
        const gameContainer = document.getElementById('gameContainer');
        const startScreen = document.getElementById('startScreen');
        const questionScreen = document.getElementById('questionScreen');
        const resultScreen = document.getElementById('resultScreen');
        const progressBar = document.getElementById('progressBar');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackArea = document.getElementById('feedbackArea');

        function startGame() {
            startScreen.classList.add('hidden');
            questionScreen.classList.remove('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            const q = questions[currentQuestionIndex];
            
            // Atualizar UI
            document.getElementById('questionCategory').innerText = q.category;
            document.getElementById('currentQ').innerText = currentQuestionIndex + 1;
            document.getElementById('totalQ').innerText = questions.length;
            document.getElementById('questionText').innerHTML = q.text; // innerHTML para permitir tags <code>

            // Barra de progresso
            const progress = ((currentQuestionIndex) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;

            // Limpar op√ß√µes e feedback
            optionsContainer.innerHTML = '';
            feedbackArea.classList.add('hidden');

            // Gerar bot√µes
            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = `option-btn w-full text-left p-4 rounded-lg border border-slate-700 bg-slate-800/50 text-slate-300 font-medium code-font hover:bg-slate-700`;
                btn.innerHTML = `<span class="inline-block w-6 font-bold text-slate-500 mr-2">${String.fromCharCode(65+index)}.</span> ${opt}`;
                btn.onclick = () => checkAnswer(index, btn);
                optionsContainer.appendChild(btn);
            });
        }

        function checkAnswer(selectedIndex, btnElement) {
            const q = questions[currentQuestionIndex];
            const buttons = optionsContainer.querySelectorAll('button');
            
            // Desabilitar todos os bot√µes
            buttons.forEach(btn => btn.classList.add('btn-disabled'));

            const isCorrect = selectedIndex === q.correct;

            if (isCorrect) {
                btnElement.classList.add('correct');
                score += 100;
                correctAnswers++;
                showFeedback(true, q.explanation);
            } else {
                btnElement.classList.add('wrong');
                // Mostrar a correta
                buttons[q.correct].classList.add('correct');
                wrongAnswers++;
                showFeedback(false, q.explanation);
            }

            scoreDisplay.innerText = score;
        }

        function showFeedback(isCorrect, text) {
            feedbackArea.classList.remove('hidden');
            const title = document.getElementById('feedbackTitle');
            const icon = document.getElementById('feedbackIcon');
            const desc = document.getElementById('feedbackText');

            if (isCorrect) {
                title.innerText = "Resposta Correta! üéØ";
                title.className = "font-bold text-green-400 mb-1";
                icon.className = "fas fa-check-circle text-green-500 mt-1";
            } else {
                title.innerText = "Resposta Incorreta ‚ùå";
                title.className = "font-bold text-red-400 mb-1";
                icon.className = "fas fa-times-circle text-red-500 mt-1";
            }

            desc.innerHTML = text;
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                loadQuestion();
            } else {
                finishGame();
            }
        }

        function finishGame() {
            questionScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            progressBar.style.width = '100%';

            document.getElementById('finalScore').innerText = score;
            document.getElementById('correctCount').innerText = correctAnswers;
            document.getElementById('wrongCount').innerText = wrongAnswers;

            // Calcular Rank
            const percentage = (correctAnswers / questions.length) * 100;
            let rank = "";
            let rankColor = "";
            let emoji = "";

            if (percentage === 100) { rank = "HOKAGE üåü"; rankColor = "text-orange-500"; emoji = "üî•"; }
            else if (percentage >= 80) { rank = "JONIN ‚öîÔ∏è"; rankColor = "text-red-500"; emoji = "ü•∑"; }
            else if (percentage >= 50) { rank = "CHUNIN üìú"; rankColor = "text-green-500"; emoji = "üòê"; }
            else { rank = "ESTUDANTE DA ACADEMIA ü•ö"; rankColor = "text-slate-500"; emoji = "üìö"; }

            const rankEl = document.getElementById('finalRank');
            rankEl.innerText = rank;
            rankEl.className = `text-xl font-bold mb-8 bg-slate-800 inline-block px-6 py-2 rounded-lg border border-slate-700 ${rankColor}`;
            document.getElementById('rankIcon').innerText = emoji;
        }
    </script>
</body>
</html>